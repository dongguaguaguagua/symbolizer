name: Build Android APK (split ABI)

on:
    push:
        branches: [main]
        paths:
            - "mobile/**"
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4

            - uses: subosito/flutter-action@v2
              with:
                  flutter-version: "3.19.x"

            - name: Install deps
              working-directory: mobile
              run: flutter pub get

            - name: Build release APK (split per ABI)
              working-directory: mobile
              run: flutter build apk --release --split-per-abi

            - name: Upload APK artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: symbolizer-apk
                  path: |
                      mobile/build/app/outputs/flutter-apk/app-*-release.apk
